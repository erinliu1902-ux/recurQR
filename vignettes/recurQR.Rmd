---
title: "recurQR: Quantile regression for recurrent episode lengths"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{recurQR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5
)
```

## What this package does

`recurQR` fits quantile regression models for **recurrent episode length** data using the
two-step estimation strategy described in:

Yi Liu, Guillermo E. Umpierrez, and Limin Peng (2025),
*Exploring the Heterogeneity in Recurrent Episode Lengths Based On Quantile Regression.*

The method is designed for settings with complications such as **dependent truncation**,
**dependent censoring**, and **informative cluster size**, and it allows both
time-independent and time-dependent covariates.

## Installation

```r
# install.packages("remotes")
remotes::install_github("erinliu1902-ux/recurQR")
```

## Quick start

Load the package and read the built-in example dataset:

```{r}
library(recurQR)

dat <- read_example_sim_data()
head(dat)
```

Fit the recurrent-episode quantile regression model.
In this example, `z1` and `z2` are treated as time-independent covariates,
and `z3` is treated as a time-dependent covariate.

```r
fit <- rqrecur(
  epi_length ~ z1 + z2 + z3,
  data = dat,
  id = "id",
  td_vars = "z3",
  tau = c(0.25, 0.5, 0.75),
  censor_time = NULL
)
```

Basic methods:

```r
print(fit)
summary(fit)
coef(fit)
```

Predict conditional quantiles for new covariate values:

```r
newdat <- data.frame(z1 = 1.3, z2 = 1, z3 = 5)
predict(fit, newdata = newdat)
```

## Bootstrap confidence intervals

The package supports a **subject-level bootstrap** for pointwise confidence intervals
across the fitted `tau` grid. Bootstrapping can take time, so the vignette does not run it
automatically:

```r
# Not run:
# fit_b <- rqrecur(
#   epi_length ~ z1 + z2 + z3,
#   data = dat,
#   id = "id",
#   td_vars = "z3",
#   tau = seq(0.2, 0.8, by = 0.1),
#   boot = TRUE,
#   B = 200,
#   seed = 1,
#   censor_time = NULL
# )
#
# confint(fit_b)
# if (interactive()) plot(fit_b)
```

## Simulation scripts shipped with the package

The scripts used for simulations in the accompanying paper are shipped under `inst/simulations`.
You can locate them with:

```{r}
system.file("simulations", package = "recurQR")
```
